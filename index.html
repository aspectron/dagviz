<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="module" src="./components/dag-viz.js"></script>
	<script src="/resources/jquery-3.4.1.js"></script>
	<!--script src="/resources/d3.v5.min.js"></script-->
	
	<script src="/resources/fabric-rpc.js"></script>
	<script src="/resources/underscore-min.js"></script>
	<script src="/resources/blockdag.sample.js"></script>
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<!--script src="https://d3js.org/d3.v3.min.js"></script-->
	<!--script src="/resources/mqttws31.js"></script-->
	<script src="/resources/mqtt.min.js"></script>
	<script type="module" src="./components/app.js"></script>
	<style type="text/css">
		#dagViz{height:100vh;}
	</style>
</head>
<body>
	<dag-viz id="dagViz"></dag-viz>

	<script type="module">
		import { App } from './components/app.js';
		$(document).ready(()=>{
			window.app = new App();
			
			var client = mqtt.connect('ws://finland.aspectron.com:7351');
		  	client.subscribe("dag/selected-tip");
			[
				'connect','disconnect','close',
				'reconnect','error','end','packetreceive'
			].forEach((op) => {
				client.on(op, (data) => {
					console.log(`${op}:`,data);
				})
			});

		 
			client.on("message", function (topic, payload) {
			    console.log([topic, payload].join(": "))
				if(topic == 'dag/selected-tip') {
					try {
						app.onDagSelectedTip(JSON.parse(payload));
					} catch(ex) {
						console.log('error parsing dag/selected-tip:', ex);
						console.log('payload:', payload);
					}
				}
			});
		})
	</script>
</body>
</html>
